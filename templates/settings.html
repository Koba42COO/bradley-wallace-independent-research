{% extends 'base.html' %}
{% block title %}SquashPlot Beta - Settings{% endblock %}
{% block head %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Settings-specific styles */
        .main-content {
            margin-left: 280px; /* Account for sidebar width */
            padding: 20px;
            min-height: calc(100vh - 80px);
            box-sizing: border-box;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
            max-width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 18px; /* Balanced padding */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: fit-content;
        }

        .settings-section h3 {
            color: #1f2937;
            margin-bottom: 12px; /* Reduced margin */
            font-size: 1.1rem; /* Slightly smaller font */
            font-weight: 600;
        }

        .setting-item {
            margin-bottom: 12px; /* Reduced margin */
        }

        .setting-item label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #374151;
        }

        .setting-item input,
        .setting-item select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .setting-item input:focus,
        .setting-item select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .btn-save {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-save:hover {
            transform: translateY(-1px);
        }

        .compression-settings {
            margin-top: 20px;
        }

        .compression-level {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .compression-level.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .compression-info {
            flex: 1;
            margin-right: 16px;
        }

        .compression-info h4 {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
        }

        .compression-info p {
            margin: 4px 0 0 0;
            font-size: 14px;
            color: #6b7280;
        }

        /* Responsive design for settings */
        
        /* Large screens - full width with 2+ columns */
        @media (min-width: 1400px) {
            .settings-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 24px;
                padding: 0 24px;
            }
        }
        
        /* Medium-large screens - 2 columns */
        @media (min-width: 1000px) and (max-width: 1399px) {
            .settings-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                padding: 0 20px;
            }
        }
        
        /* Medium screens - 2 columns but smaller */
        @media (min-width: 800px) and (max-width: 999px) {
            .settings-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                padding: 0 16px;
            }
            
            .settings-section {
                padding: 14px;
            }
        }
        
        /* Small-medium screens - single column */
        @media (min-width: 600px) and (max-width: 799px) {
            .settings-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 0 16px;
            }
        }
        
        /* Mobile screens - compact single column */
        @media (max-width: 599px) {
            .main-content {
                margin-left: 0; /* Remove sidebar offset on mobile */
                padding: 12px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-top: 12px;
                padding: 0 12px;
            }
            
            .settings-section {
                padding: 12px;
            }
        }
        
        /* Tablet screens - adjust main content */
        @media (min-width: 600px) and (max-width: 1024px) {
            .main-content {
                margin-left: 0; /* Remove sidebar offset on tablet */
                padding: 16px;
            }
        }
    </style>
{% endblock %}
{% block content %}
<div data-section="settings">
    <div class="enterprise-layout">
        <!-- Fixed Header -->
        <header class="enterprise-header">
            <div class="connection-status">
                <div class="tool-indicators">
                    <div id="madmax-status" class="tool-status offline">
                        <div class="status-dot"></div>
                        MadMax
                    </div>
                    <div id="bladebit-status" class="tool-status offline">
                        <div class="status-dot"></div>
                        BladeBit
                    </div>
                    <div id="chia-status" class="tool-status offline">
                        <div class="status-dot"></div>
                        Chia
                    </div>
                </div>
            </div>

            <div class="price-ticker">
                <span id="xch-price">Loading XCH price...</span>
            </div>

            <div class="user-profile">
                <span id="user-info">Demo User</span>
                <div class="user-avatar">üë§</div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="enterprise-sidebar">

            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="/dashboard" class="nav-item">
                        <span class="nav-icon">üìä</span>Dashboard
                    </a>
                    <a href="/jobs" class="nav-item">
                        <span class="nav-icon">‚ö°</span>Plotting Jobs
                    </a>
                    <a href="/storage" class="nav-item">
                        <span class="nav-icon">üíæ</span>Storage
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Farming</div>
                    <a href="/rewards" class="nav-item">
                        <span class="nav-icon">üí∞</span>Rewards
                    </a>
                    <a href="/pools" class="nav-item">
                        <span class="nav-icon">üèä</span>Pools
                    </a>
                    <a href="/analytics" class="nav-item">
                        <span class="nav-icon">üìà</span>Analytics
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <a href="/settings" class="nav-item active">
                        <span class="nav-icon">‚öô</span>Settings
                    </a>
                    <a href="/help" class="nav-item">
                        <span class="nav-icon">‚ùì</span>Help
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h1>Settings</h1>
                <p>Configure SquashPlot to optimize your Chia farming experience</p>
            </div>

            <div class="settings-grid">
                <!-- General Settings -->
                <div class="settings-section">
                    <h3>General Settings</h3>

                    <div class="setting-item">
                        <label for="theme">Theme</label>
                        <select id="theme">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="auto">Auto</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="language">Language</label>
                        <select id="language">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="auto-start">Auto-start on system boot</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="auto-start">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Compression Settings -->
                <div class="settings-section">
                    <h3>Compression Settings</h3>

                    <div class="setting-item">
                        <label for="default-compression">Default Compression Level</label>
                        <select id="default-compression">
                            <option value="0">No Compression</option>
                            <option value="1" selected>Basic (20% savings)</option>
                            <option value="2">Standard (25% savings)</option>
                            <option value="3">High (30% savings)</option>
                            <option value="4">Ultra (35% savings)</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="auto-compress">Auto-compress new plots</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="auto-compress" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="compression-settings">
                        <h4>Available Compression Levels</h4>
                        <div id="compression-levels-container">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Plotting Settings -->
                <div class="settings-section">
                    <h3>Plotting Settings</h3>

                    <div class="setting-item">
                        <label for="plotter">Default Plotter</label>
                        <select id="plotter">
                            <option value="madmax">MadMax</option>
                            <option value="bladebit">BladeBit</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="threads">Default Threads</label>
                        <select id="threads">
                            <option value="2">2 Threads</option>
                            <option value="4" selected>4 Threads</option>
                            <option value="8">8 Threads</option>
                            <option value="16">16 Threads</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="buckets">Default Buckets</label>
                        <select id="buckets">
                            <option value="128">128</option>
                            <option value="256" selected>256</option>
                            <option value="512">512</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="temp-dir">Temporary Directory</label>
                        <input type="text" id="temp-dir" placeholder="/tmp/squashplot">
                    </div>

                    <div class="setting-item">
                        <label for="final-dir">Final Directory</label>
                        <input type="text" id="final-dir" placeholder="/plots">
                    </div>
                </div>

                <!-- Wallet Settings -->
                <div class="settings-section">
                    <h3>Wallet Settings</h3>

                    <div class="setting-item">
                        <label for="wallet-address">Wallet Address (Optional)</label>
                        <input type="text" id="wallet-address" placeholder="xch1...">
                    </div>

                    <div class="setting-item">
                        <label for="auto-claim">Auto-claim rewards</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="auto-claim">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-item">
                        <label for="claim-threshold">Claim threshold (XCH)</label>
                        <input type="number" id="claim-threshold" step="0.1" min="0" value="0.1">
                    </div>
                </div>

                <!-- System Settings -->
                <div class="settings-section">
                    <h3>System Settings</h3>

                    <div class="setting-item">
                        <label for="log-level">Log Level</label>
                        <select id="log-level">
                            <option value="DEBUG">Debug</option>
                            <option value="INFO" selected>Info</option>
                            <option value="WARNING">Warning</option>
                            <option value="ERROR">Error</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="max-jobs">Maximum Concurrent Jobs</label>
                        <select id="max-jobs">
                            <option value="1">1 Job</option>
                            <option value="2" selected>2 Jobs</option>
                            <option value="4">4 Jobs</option>
                            <option value="8">8 Jobs</option>
                        </select>
                    </div>

                    <div class="setting-item">
                        <label for="cleanup-logs">Auto-cleanup old logs</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="cleanup-logs" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="settings-actions" style="margin-top: 32px; text-align: center;">
                <button class="btn-save" onclick="saveSettings()">
                    üíæ Save Settings
                </button>
                <button class="btn-ghost" onclick="resetToDefaults()" style="margin-left: 16px;">
                    üîÑ Reset to Defaults
                </button>
            </div>
        </main>
    </div>
    <!-- Scripts -->
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/auth-features.js"></script>
    <script src="/static/js/wallet-connect.js"></script>

    <!-- Settings-specific JavaScript -->
    <script>
        // Load compression levels
        async function loadCompressionLevels() {
            try {
                const response = await fetch('/api/compression-levels');
                const levels = await response.json();

                const container = document.getElementById('compression-levels-container');
                container.innerHTML = '';

                levels.forEach(level => {
                    const levelDiv = document.createElement('div');
                    levelDiv.className = `compression-level ${level.level == 1 ? 'selected' : ''}`;

                    levelDiv.innerHTML = `
                        <div class="compression-info">
                            <h4>Level ${level.level}: ${level.description}</h4>
                            <p>${level.savings_percent}% space savings ‚Ä¢ ${level.estimated_size_gb}GB estimated</p>
                        </div>
                        <input type="radio" name="compression-level" value="${level.level}"
                               ${level.level == 1 ? 'checked' : ''}>
                    `;

                    container.appendChild(levelDiv);
                });
            } catch (error) {
                console.error('Failed to load compression levels:', error);
            }
        }

        // Save settings
        function saveSettings() {
            const settings = {
                theme: document.getElementById('theme').value,
                language: document.getElementById('language').value,
                autoStart: document.getElementById('auto-start').checked,
                defaultCompression: document.getElementById('default-compression').value,
                autoCompress: document.getElementById('auto-compress').checked,
                plotter: document.getElementById('plotter').value,
                threads: document.getElementById('threads').value,
                buckets: document.getElementById('buckets').value,
                tempDir: document.getElementById('temp-dir').value,
                finalDir: document.getElementById('final-dir').value,
                walletAddress: document.getElementById('wallet-address').value,
                autoClaim: document.getElementById('auto-claim').checked,
                claimThreshold: document.getElementById('claim-threshold').value,
                logLevel: document.getElementById('log-level').value,
                maxJobs: document.getElementById('max-jobs').value,
                cleanupLogs: document.getElementById('cleanup-logs').checked
            };

            // Save to localStorage for demo purposes
            localStorage.setItem('squashplot_settings', JSON.stringify(settings));

            // Show success message
            alert('‚úÖ Settings saved successfully!');

            console.log('Settings saved:', settings);
        }

        // Reset to defaults
        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                localStorage.removeItem('squashplot_settings');
                location.reload();
            }
        }

        // Load saved settings
        function loadSettings() {
            const saved = localStorage.getItem('squashplot_settings');
            if (saved) {
                const settings = JSON.parse(saved);

                // Apply saved settings to form
                Object.keys(settings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = settings[key];
                        } else {
                            element.value = settings[key];
                        }
                    }
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadCompressionLevels();

            // Update tool statuses
            updateToolStatus('madmax', 'offline');
            updateToolStatus('bladebit', 'offline');
            updateToolStatus('chia', 'offline');

            updatePriceTicker();
            setInterval(updatePriceTicker, 30000);
        });

        // Safe DOM functions (same as dashboard)
        function safeGetElement(id) {
            return document.getElementById(id);
        }

        function updateToolStatus(toolName, status) {
            const element = safeGetElement(`${toolName.toLowerCase()}-status`);
            if (element) {
                element.className = `tool-status ${status}`;
                const dot = element.querySelector('.status-dot');
                if (dot) {
                    dot.style.backgroundColor = status === 'online' ? '#16a34a' : '#dc2626';
                }
            }
        }

        function updatePriceTicker() {
            const tickerElement = safeGetElement('xch-price');
            if (tickerElement) {
                const mockPrice = (Math.random() * 0.5 + 0.2).toFixed(4);
                tickerElement.textContent = `XCH $${mockPrice}`;
            }
        }
    </script>
{% endblock %}

